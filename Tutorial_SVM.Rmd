---
title: "Support Vector Machines in R"
author: 
  - name: "Carlos A. Ar."
  - name: "Ciencia de Datos"
  - name: "Facultad de Ciencias"
  - name: "UNAM"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{=html}
<style>
div {
  text-align: justify;
}
/***********************/
/*Títulos ## y autoría F6EACD*/
/***********************/
h1, h2 {
  color: #6D4101;
  padding: .4em; /*es decir el 60 por ciento del tamaño de la letra*/
  font-family: "Courier New", monospace;
  font-size: 35px;
  font-weight: bold;
  opacity: 0.95;
}
em {
  color: #8A6C0C;
  font-family: "Courier New", monospace;
  font-size: 18px;
  padding: .2em;
  opacity: 0.97;
  font-weight: bold;
}
/***********************/
/* Cuerpo */
/***********************/
body {
  font-family: Verdana, Helvetica, sans-serif;
  font-size: 16;
  background-color: #EEF5F9;
  color: #000000;
}
/***********************/
/* Títulos con ###     */
/***********************/
h3, h4, h5{
  color: #06116C;
  font-family: Verdana, Helvetica, sans-serif;
}
/*******************************************/
/* Referencias a páginas o a otro documento*/
/*******************************************/
a {
    color: #B8870F;
    text-decoration: none;
}
/**********************/
/* Chunks de exercises*/
/**********************/
.ace-tm {
    background-color: #FFFEF7;
    color: #010730;
}
/***********************/
/* tabla de contenidos */
/***********************/
.topicsList {
  padding: .5em;
}
.topicsHeader {
  color: #06116C;
  padding: .5em;
}
.topicsList #doc-metadata {
  color: #06116C;
  padding: .5em;
}
.topicsList .topic.current {
  background-color: #8A6C0C;
  color: #FFFFFF;
  font-weight: bold;
}
.topicsList .topic:hover, .topicsList .topic:active {
  background-color: #E0CD4E;
  color: #01053D;
}
/***********/
/* Botones */
/***********/
.btn {
  background-color: #000857;
  color: #EBEDFF;
}
/* cambiar de página */
.btn-default {
    color: #EBEDFF;
    background-color: #000857;
    border: none;
}
/* cambiar de página */
.btn-light {
  background-color: #000857;
  color: #EBEDFF;
}
/* run code */
.btn-primary , .btn-success, .btn-info{
  background-color: #786300;
  color: #EBEDFF;
}
/* mientras está desabilitados */
.btn:hover, .btn:active, .btn:disabled {
  background-color: #786300;
  color: #EBEDFF;
}
/**********/
/* Código */
/**********/
code {
    color: #6D4101;
    background-color:  #F7FBF9;
    font-size: 15px;
    font-weight: bold;
}
/**************************/
/* Recuadro para ejemplos */
/**************************/
.boxed {
    background: #F7FBF9;
    color: black;
    border: 3px solid #C83737;
    margin: 0px auto;
    width: 456px;
    padding: 10px;
    border-radius: 10px;
  }
.note {
    padding: 1em;
    margin: 1em 0;
    padding-left: 100px;
    background-size: 70px;
    background-repeat: no-repeat;
    background-position: 15px 15px;
    min-height: 120px;
    color: black;
    background-color: lightgrey;
    border: solid 5px #C83737;
    background-image: url("manzana.png");
  }
.note_white {
    padding: 1em;
    margin: 1em 0;
    padding-left: 100px;
    background-size: 70px;
    background-repeat: no-repeat;
    background-position: 15px 15px;
    min-height: 120px;
    color: black;
    background-color: #F7FBF9;
    border: solid 5px #C83737;
    background-image: url("manzana.png");
  }
</style>
```

```{r setup, include=FALSE}
#Librerías a usar

  #Hacer el tutorial
  library(learnr)
  #Hacer los modelos de SVM
  library(e1071)
  #Hacer gráficas bonitas e interactivas
  library(ggplot2)
  library(plotly)
  #Leer los archivos csv
  library(readxl)
  #Manejar los archivos
  library(dplyr)

#Modificaciónes para los chunks
knitr::opts_chunk$set(echo = FALSE, fig.align ='center')

```

```{r datas}
  # Popcorn
popcorn <- read.csv("https://raw.githubusercontent.com/CarlosA-Ar/SVM-con-R/main/csvs/Popcorn.csv")
popcorn <- popcorn[, -1]
popcorn$Brand <- as.factor(popcorn$Brand)

  # Fishing: filtrando
fishing <- read.csv("https://raw.githubusercontent.com/CarlosA-Ar/SVM-con-R/main/csvs/Fishing.csv")
fishing <- fishing[, -1]
fishing$mode <- as.factor(fishing$mode)
fishing <- fishing %>% select(price, pbeach, mode) %>% filter(fishing$mode == "boat" | fishing$mode == "charter")

plot_popcorn <- ggplot(popcorn, aes(x = Unpopped , y =  Trial, color = Brand)) + geom_point() + ggtitle("Popcorn") + theme_minimal()

plot_fishing <- ggplot(fishing, aes(x = price, y = pbeach, color = mode)) + geom_point() + ggtitle("Fishing")+ theme_minimal()
```

## Introducción

El tutorial usará dos datasets para ejemplificar el uso de los diferentes kernels (famosos) y utilidad de esta función.

Si quieres conocer algunas ideas teóricas de esta técnica _SVM_, constulta este [breve artículo](https://maquinas-de-soporte-vectorial.netlify.app/).

### Objetivo

El tutorial busca que aprendas las bases sobre la función `svm()` de la librería `e1071`. Esta función permite implementar la técnica de clásificación _Support Vector Machines_ en datasets.

### Cargar librería

Para poder hacer uso de la función `svm()`, es primordial cargar la librería `e1071`, puedes hacerlo en el siguiente espacio de código.

```{r ej1, exercise=TRUE}
#
library(____)
#
```

### Parámetros de svm()

- `formula`: respuesta ~ explicativas

- `data`: data.frame

- `scale`: ¿Se escalan los datos? Verdadero (T) o Falso (F)

- `type`: "C-classification" por defecto.

- `kernel`: tipo de kernel

    - "linear": $K(x_i, x_j) =\displaystyle \sum_{l = 1}^p x_{il}x_{jl}$
    
    - "polynomial": $K(x_i, x_j) = \bigg( 1 + \displaystyle \sum_{l = 1}^p x_{il}x_{jl}\bigg)^d$
    
    - "radial": $K(x_i, x_j) = \exp \bigg\{ -\gamma \displaystyle \sum_{l = 1}^p (x_{il} - x_{jl})^2\bigg\}$

- `cost`: 1, por defecto. Es la $C$ del problema de optimización.

Ve más sobre la función en la [documentación de R](https://www.rdocumentation.org/packages/e1071/versions/1.7-8)

## Palomitas de maíz

En esta sección consideremos el dataset siguiente:

### Forma de los datos

- __Popcorn__: éxito en que las palomitas reventaran. 

    Son 12 observaciones, la variable respuesta tiene las etiquetas "Orville" y "Seaway" que significan de mantequilla o de dulce, respectivamente.
    
    Las variables explicativas son "Trial" y "Unpopped" lo cual implica que un punto formado por estas variables se referirá a cuándo una palomita que se calentó, explotó.
    
<div>
<p style = 'text-align:center;'>
![](https://images.squarespace-cdn.com/content/v1/529cfbbce4b05681be287bef/1579061662005-4Q3XJ4BHFEAN3OCE0Z5J/Popcorn.gif){width='350px'}
</p>
</div>

En el siguiente código puedes explorar de forma visual la forma en que se acomodan las observaciones en el data set popcorn.

```{r pl1, exercise = TRUE, exercise.setup = "datas"}
ggplot(popcorn, aes(x = Unpopped , y =  Trial, color = Brand)) +
  geom_point(size = 4) + 
  ggtitle("Popcorn") + 
  theme_minimal()
```

### Crear modelo

El siguiente ejercicio es para que crees un modelo de SVM en el que uses el dataset `popcorn`.

```{r ej2, exercise=TRUE, exercise.setup = "datas", exercise.lines = 21}
popsvm <- svm(
  formula = Brand ~ .,
  data = popcorn,
  scale = FALSE,
  type = "C-classification",
  kernel = "linear",
  cost = 1
)

#Utiliza una función para saber 
# el contenido de este modelo

___(popsvm)

# Visualmente
plot(popsvm, popcorn)

# Exactitud de clasificación
predpop <- predict(popsvm, popcorn)
mean(predpop == popcorn$Brand)

```

## Pesca y a comer

En esta sección consideremos el dataset siguiente:

- __Fishing__: elección del modo de pesca.

    1182 observaciones con una variable respuesta con dos etiquetas: "charter" (servicio de excursiones ofrecido por propietarios de botes y pescadores profesionales que lleva a los huéspedes a un cuerpo de agua durante un período determinado con la esperanza de pescar) y "boat" que se refieren a hacer la pesca en bote pero no a la carta.
    
    Las variables explicativas son dos: "pbeach" o lejanía de la playa y "price" o costo del viaje.
    
<div>
<p style = 'text-align:center;'>
![](https://i.gifer.com/UAG7.gif){width='350px'}
</p>
</div>


```{r pl2, exercise = TRUE, exercise.setup = "datas", exercise.lines = 1}
plot_fishing
```

### Crear modelo

Puedes explorar los distintos tipos de kernel existentes.

```{r ej3, exercise=TRUE, exercise.setup = "datas", exercise.timelimit = 159159159159159159159}
fish_svm <- svm(
  formula = mode ~ .,
  data = fishing,
  scale = FALSE,
  type = "C-classification",
  kernel = "polynomial",
  cost = 1
)

# Visualmente
plot(fish_svm, fishing)

# Exactitud de clasificación
predfish <- predict(fish_svm, fishing)
mean(predfish == fishing$mode)
```